<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Tiket | Mahika Trans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f0f4f8; }
        .ticket-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .dotted-line { border-top: 2px dotted #e2e8f0; position: relative; margin: 20px 0; }
        .dotted-line::before, .dotted-line::after { content: ''; position: absolute; top: -11px; width: 22px; height: 22px; background: #f0f4f8; border-radius: 50%; }
        .dotted-line::before { left: -31px; }
        .dotted-line::after { right: -31px; }
    </style>
</head>
<body class="p-6">

<div id="loader" class="text-center mt-20 text-gray-400">Memuat Tiket...</div>

<div id="ticket-container" class="hidden max-w-sm mx-auto">
    <div class="ticket-card">
        <div class="bg-blue-900 p-6 text-center text-white">
            <h2 class="font-bold tracking-tighter text-xl">MAHIKA TRANS</h2>
            <p class="text-[10px] opacity-60 uppercase tracking-widest">Official E-Ticket</p>
        </div>
        
        <div class="p-6">
            <div class="flex justify-between mb-4">
                <div>
                    <p class="text-[9px] uppercase font-bold text-gray-400">Penumpang</p>
                    <p id="t-nama" class="font-bold text-blue-900 uppercase"></p>
                </div>
                <div class="text-right">
                    <p class="text-[9px] uppercase font-bold text-gray-400">Kursi</p>
                    <p id="t-kursi" class="font-bold text-blue-900"></p>
                </div>
            </div>

            <div class="mb-4">
                <p class="text-[9px] uppercase font-bold text-gray-400">Armada / PO</p>
                <p id="t-armada" class="font-bold text-gray-800"></p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <p class="text-[9px] uppercase font-bold text-gray-400">Tanggal</p>
                    <p id="t-tgl" class="font-bold text-gray-800 text-sm"></p>
                </div>
                <div>
                    <p class="text-[9px] uppercase font-bold text-gray-400">Jam</p>
                    <p id="t-jam" class="font-bold text-gray-800 text-sm"></p>
                </div>
            </div>

            <div class="dotted-line"></div>

            <div class="mb-4">
                <p class="text-[9px] uppercase font-bold text-gray-400">Tujuan</p>
                <p id="t-tujuan" class="font-bold text-blue-700"></p>
            </div>

            <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center">
                <span class="text-[10px] font-bold text-gray-400 uppercase">Total Bayar</span>
                <span id="t-harga" class="font-black text-lg text-blue-900"></span>
            </div>
        </div>
        
        <div class="bg-gray-100 p-4 text-center">
            <p class="text-[8px] text-gray-400">Tunjukkan tiket ini saat keberangkatan</p>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAmTAWHcHpolaIHegLceyMqExVgzufJzaU",
        authDomain: "mahika-trans.firebaseapp.com",
        projectId: "mahika-trans",
        storageBucket: "mahika-trans.firebasestorage.app",
        appId: "1:1087881066133:web:148d51c88f1de3466ecd9c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const bookingId = urlParams.get('id');

    async function getTicket() {
        if(!bookingId) return alert("ID Tidak Valid");
        
        const docRef = doc(db, "bookings", bookingId);
        const snap = await getDoc(docRef);

        if (snap.exists()) {
            const d = snap.data();
            document.getElementById('t-nama').innerText = d.nama;
            document.getElementById('t-kursi').innerText = d.kursi + " Pax";
            document.getElementById('t-armada').innerText = d.armada;
            document.getElementById('t-tgl').innerText = d.tgl;
            
            // Bersihkan jam dari double WIB
            let jamBersih = d.jam ? d.jam.replace(/WIB/g, '').trim() : '--:--';
            document.getElementById('t-jam').innerText = jamBersih + " WIB";
            
            document.getElementById('t-tujuan').innerText = d.tujuan;
            
            // Format Harga Rupiah
            const nominal = d.harga ? parseInt(d.harga).toLocaleString('id-ID') : '0';
            document.getElementById('t-harga').innerText = "Rp " + nominal;

            document.getElementById('loader').classList.add('hidden');
            document.getElementById('ticket-container').classList.remove('hidden');
        } else {
            document.getElementById('loader').innerText = "Tiket tidak ditemukan.";
        }
    }
    getTicket();
</script>
</body>
</html>
