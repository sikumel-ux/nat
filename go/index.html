<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E-Ticket Mahika Trans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Plus+Jakarta+Sans:wght@800&family=Libre+Barcode+128&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { background: #d1d5db; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        
        /* GAYA TRAVEL: KWITANSI KERTAS KLASIK */
        .paper-receipt { 
            background: #fff; font-family: 'Courier Prime', monospace; 
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1); padding: 30px; border: 1px solid #ddd;
            position: relative;
        }
        .paper-receipt::after {
            content: ""; position: absolute; bottom: -10px; left: 0; width: 100%; height: 10px;
            background: linear-gradient(-45deg, #fff 5px, transparent 0), linear-gradient(45deg, #fff 5px, transparent 0);
            background-size: 10px 10px;
        }

        /* GAYA BUS: MODERN TICKET STUB */
        .bus-ticket {
            background: #065084; color: white; font-family: 'Plus Jakarta Sans', sans-serif;
            border-radius: 20px; overflow: hidden; position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .bus-ticket .notch {
            position: absolute; width: 40px; height: 40px; background: #d1d5db; border-radius: 50%; top: 60%;
        }
        .barcode { font-family: 'Libre Barcode 128', cursive; font-size: 70px; }
    </style>
</head>
<body>

    <div id="loading" class="font-bold text-slate-600">MENYIAPKAN TIKET...</div>

    <div id="view-travel" class="hidden w-full max-w-sm paper-receipt">
        <div class="text-center border-b-2 border-black pb-4 mb-4">
            <h1 class="text-2xl font-bold">MAHIKA TRANS</h1>
            <p class="text-xs">Travel & Shuttle Service</p>
        </div>
        <div class="space-y-4 text-sm">
            <p class="text-center font-bold underline">KWITANSI PEMBAYARAN</p>
            <p>Telah diterima dari: <br><span id="t-nama" class="font-bold text-lg uppercase"></span></p>
            <p>Untuk Pembayaran: <br><span class="font-bold">Travel Jurusan <span id="t-tujuan" class="uppercase"></span></span></p>
            <div class="border-2 border-black p-2 text-center">
                <p class="text-xs">JUMLAH (Rp):</p>
                <p id="t-nominal" class="text-2xl font-bold"></p>
            </div>
            <p class="italic text-xs">Terbilang: <span id="t-terbilang"></span></p>
            <div class="flex justify-between items-end pt-4">
                <div class="text-[10px]">
                    <p id="t-tgl"></p>
                    <p id="t-jam"></p>
                </div>
                <img id="t-qr" class="w-20 h-20">
            </div>
        </div>
    </div>

    <div id="view-bus" class="hidden w-full max-w-sm bus-ticket">
        <div class="p-6 bg-yellow-400 text-blue-900 flex justify-between items-center">
            <span class="font-black italic text-xl">MAHIKA BUS</span>
            <span class="text-[10px] font-bold border-2 border-blue-900 px-2 py-1 rounded">BOARDING PASS</span>
        </div>
        <div class="p-6 space-y-6">
            <div class="flex justify-between">
                <div>
                    <p class="text-blue-200 text-[10px] uppercase font-bold">Passenger</p>
                    <p id="b-nama" class="text-xl font-bold leading-none"></p>
                </div>
                <div class="text-right">
                    <p class="text-blue-200 text-[10px] uppercase font-bold">Seat</p>
                    <p id="b-kursi" class="text-3xl font-black leading-none"></p>
                </div>
            </div>
            <div class="flex justify-between border-t border-blue-400 pt-4">
                <div>
                    <p class="text-blue-200 text-[10px] uppercase font-bold">Destination</p>
                    <p id="b-tujuan" class="font-bold uppercase"></p>
                </div>
                <div class="text-right">
                    <p class="text-blue-200 text-[10px] uppercase font-bold">Time</p>
                    <p id="b-jam" class="font-bold"></p>
                </div>
            </div>
            <div class="notch -left-5"></div>
            <div class="notch -right-5"></div>
            
            <div class="pt-8 flex flex-col items-center">
                <p class="barcode">12345678</p>
                <p id="b-id" class="text-[10px] tracking-[4px] opacity-50"></p>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyAmTAWHcHpolaIHegLceyMqExVgzufJzaU", 
            authDomain: "mahika-trans.firebaseapp.com", 
            projectId: "mahika-trans", 
            storageBucket: "mahika-trans.firebasestorage.app", 
            appId: "1:1087881066133:web:148d51c88f1de3466ecd9c" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const params = new URLSearchParams(window.location.search);
        let bid = params.get('id');

        async function init() {
            if (!bid) return;
            try {
                let doc = await db.collection("bookings").doc(bid).get();
                if (doc.exists) {
                    const data = doc.data();
                    document.getElementById('loading').style.display = 'none';

                    if (data.layanan === 'travel') {
                        document.getElementById('view-travel').classList.remove('hidden');
                        document.getElementById('t-nama').innerText = data.nama;
                        document.getElementById('t-tujuan').innerText = data.tujuan;
                        document.getElementById('t-nominal').innerText = "Rp " + Number(data.nominal).toLocaleString('id-ID');
                        document.getElementById('t-terbilang').innerText = terbilang(data.nominal) + " Rupiah";
                        document.getElementById('t-tgl').innerText = "Tgl: " + data.tgl;
                        document.getElementById('t-jam').innerText = "Jam: " + data.jam;
                        document.getElementById('t-qr').src = `https://chart.googleapis.com/chart?chs=150x150&cht=qr&chl=${bid}`;
                    } else {
                        document.getElementById('view-bus').classList.remove('hidden');
                        document.getElementById('b-nama').innerText = data.nama;
                        document.getElementById('b-kursi').innerText = data.kursi || '-';
                        document.getElementById('b-tujuan').innerText = data.tujuan;
                        document.getElementById('b-jam').innerText = data.tgl + " | " + data.jam;
                        document.getElementById('b-id').innerText = bid.substring(0,8).toUpperCase();
                    }
                }
            } catch (e) { console.log(e); }
        }

        function terbilang(n) {
            const b = ["", "Satu", "Dua", "Tiga", "Empat", "Lima", "Enam", "Tujuh", "Delapan", "Sembilan", "Sepuluh", "Sebelas"];
            if (n < 12) return b[n];
            if (n < 20) return terbilang(n - 10) + " Belas";
            if (n < 100) return terbilang(Math.floor(n / 10)) + " Puluh " + terbilang(n % 10);
            if (n < 200) return "Seratus " + terbilang(n - 100);
            if (n < 1000) return terbilang(Math.floor(n / 100)) + " Ratus " + terbilang(n % 100);
            return "Ribuan";
        }
        init();
    </script>
</body>
</html>
