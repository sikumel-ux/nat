<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Tiket | Mahika</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { background: #043a60; color: white; font-family: 'Poppins', sans-serif; }
        .input-field { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; }
        .nav-bottom { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; background: white; display: flex; justify-content: space-around; padding: 15px 0; border-radius: 25px; }
        .nav-bottom a { color: #999; text-align: center; font-size: 10px; flex: 1; text-decoration: none; }
        .nav-bottom a.active { color: #065084; }
    </style>
</head>
<body class="p-6">
    <h2 class="text-2xl font-bold mb-6 text-yellow-400 italic">Booking Tiket</h2>
    
    <div class="space-y-4 pb-32">
        <input type="text" id="nama" placeholder="Nama Penumpang" class="w-full p-4 rounded-2xl input-field outline-none">
        <input type="number" id="hp" placeholder="WhatsApp (628...)" class="w-full p-4 rounded-2xl input-field outline-none">
        <div class="flex gap-2">
            <input type="date" id="tgl" class="flex-1 p-4 rounded-2xl input-field outline-none text-sm">
            <input type="time" id="jam" class="flex-1 p-4 rounded-2xl input-field outline-none text-sm">
        </div>
        <select id="armada" class="w-full p-4 rounded-2xl input-field outline-none">
            <option value="Hiace Premio">Hiace Premio</option>
            <option value="Innova Reborn">Innova Reborn</option>
        </select>
        <input type="text" id="tujuan" placeholder="Tujuan" class="w-full p-4 rounded-2xl input-field outline-none">
        <div class="flex gap-2">
            <input type="text" id="kursi" placeholder="Seat" class="w-20 p-4 rounded-2xl input-field outline-none">
            <input type="number" id="harga" placeholder="Harga" class="flex-1 p-4 rounded-2xl input-field outline-none">
        </div>
        <button id="btnSave" class="w-full bg-yellow-500 text-[#043a60] font-black py-4 rounded-2xl shadow-lg uppercase">Simpan & Kirim WA</button>
    </div>

    <div class="nav-bottom">
        <a href="index.html"><i class="fas fa-house block text-lg"></i>Home</a>
        <a href="input.html" class="active"><i class="fas fa-circle-plus block text-lg"></i>Input</a>
        <a href="#"><i class="fas fa-wallet block text-lg"></i>Komisi</a>
        <a href="#" id="logoutBtn"><i class="fas fa-right-from-bracket block text-lg"></i>Logout</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyAmTAWHcHpolaIHegLceyMqExVgzufJzaU", authDomain: "mahika-trans.firebaseapp.com", projectId: "mahika-trans", storageBucket: "mahika-trans.firebasestorage.app", messagingSenderId: "1087881066133", appId: "1:1087881066133:web:148d51c88f1de3466ecd9c" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        document.getElementById('btnSave').onclick = async () => {
            const btn = document.getElementById('btnSave');
            const data = {
                nama: document.getElementById('nama').value,
                hp: document.getElementById('hp').value,
                tgl: document.getElementById('tgl').value,
                jam: document.getElementById('jam').value,
                armada: document.getElementById('armada').value,
                tujuan: document.getElementById('tujuan').value,
                kursi: document.getElementById('kursi').value,
                harga: document.getElementById('harga').value
            };

            btn.innerText = "Saving...";
            try {
                const docRef = await addDoc(collection(db, "bookings"), data);
                const etiketURL = `https://${window.location.hostname}/etiket.html?id=${docRef.id}`;
                const waText = `*TIKET MAHIKA TRANS*\n\nNama: ${data.nama}\nJadwal: ${data.tgl} | ${data.jam}\nKursi: ${data.kursi}\n\nE-Ticket: ${etiketURL}`;
                window.open(`https://wa.me/${data.hp}?text=${encodeURIComponent(waText)}`, '_blank');
                location.href = "index.html";
            } catch (e) { alert(e.message); btn.innerText = "Simpan"; }
        };
        document.getElementById('logoutBtn').onclick = () => signOut(auth).then(() => location.href = "login.html");
    </script>
</body>
</html>
